# マルチタスク分類Webアプリケーション

このウェブアプリケーションは、機械学習を利用して、テキストデータと画像データの分類を行うためのRESTful APIとインターフェースを提供します。アプリケーションは、複数の分類タスクを統合的に管理し、効率的に提供することを目的としています。

![Architecture](image/webapp.png)
![Streamlit](image/streamlit_app.png)

## 目次
1. [使用するモデルとその目的](#使用するモデルとその目的)
2. [マルチタスクAPIの構造](#マルチタスクAPIの構造)
3. [アーキテクチャ](#アーキテクチャ)
4. [データ検証とAPIテスト](#データ検証とAPIテスト)
5. [デプロイメント](#デプロイメント)
6. [使用ツール](#使用ツール)

## 使用するモデルとその目的

### 感情分類モデル
- **目的**: 映画レビューをポジティブまたはネガティブに分類する。

### 災害ツイート分類モデル
- **目的**: ツイートが災害に関連しているかどうかを判断する。

### 人間のポーズ分類モデル
- **目的**: 画像データから人間の行動（例：立っている、座っているなど）を分類する。

これらのモデルはBERTとその軽量版であるTiny BERTを使用して実装されています。Tiny BERTはリソース消費を最小限に抑えつつ高精度を維持するように最適化されています。モデルはHuggingFaceツールを使用してトレーニングされ、Amazon S3に保存されています。サーバーはS3からモデルをダウンロードし、FastAPIフレームワークを通じてユーザーに提供します。

## マルチタスクAPIの構造

このウェブアプリケーションは、複数のモデルを単一のAPIに統合し、ユーザーが単一のインターフェースを通じて様々な分類タスクを実行できるようにしています。たとえば、ユーザーは特定のエンドポイントにリクエストを送信して、センチメント分類、災害ツイート分類、人間のポーズ分類を行うことができます。

## アーキテクチャ

- **FastAPIとUvicornサーバー**: アプリケーションはFastAPIフレームワークを使用して構築されており、これは高速で軽量なPython用のウェブフレームワークです。FastAPIはUvicornサーバーと組み合わせて使用され、高性能なAPIを提供します。

- **MLモデル統合**: FastAPIがリクエストを受け取ると、適切な機械学習モデルに入力データを渡して分類結果を生成します。結果はユーザーに返され、特定のタスクに合わせて調整されます。

- **ユーザーインターフェース**: Streamlitを使用して簡単なウェブインターフェースを作成し、ユーザーがAPIと簡単に対話できるようにしています。ユーザーはセンチメント分類、災害ツイート分類、人間のポーズ分類を簡単に実行できます。

## データ検証とAPIテスト

- **Pydanticによるデータ検証**: FastAPIはPydanticを使用してデータモデルを定義し、APIに送信されるデータの整合性を検証します。これにより、正確なデータのみがシステムに入ることが保証されます。

- **APIテスト**: POSTMANなどのツールを使用してAPIをテストし、期待通りに動作することを確認します。

## デプロイメント

- **AWS EC2へのデプロイメント**: モデルとAPIはAWS EC2サーバーにデプロイされ、これにより本番環境でアクセスできるようになります。これにより、インターネット経由でAPIにアクセスし、様々なタスクにモデルを活用することができます。

## 使用ツール

- **FastAPI**: Python 3.8+でAPIを構築するための現代的で高速なウェブフレームワーク。
- **Uvicorn**: FastAPIアプリケーションを提供するための超高速ASGIサーバー。
- **Streamlit**: Pythonでインタラクティブなウェブアプリケーションを作成するためのフレームワーク。
- **HuggingFace Transformers**: BERTやTiny BERTなどの最先端NLPモデルのためのライブラリ。
- **Pydantic**: Pythonの型アノテーションを使用したデータ検証と設定管理。
- **POSTMAN**: APIのテストに人気のあるツール。
- **AWS S3**: モデルを保存および取得するためのAmazonのクラウドストレージサービス。
- **AWS EC2**: アプリケーションをデプロイするためのAmazonのクラウドコンピューティングサービス。
- **Docker** (オプション): アプリケーションと依存関係をパッケージ化するためのコンテナ化ツール。

## 主要な機能と設計上のこだわり

### 1. **データモデルの明確な定義とバリデーション**
   - APIでは、Pydanticを使用して入力と出力のデータモデルを厳密に定義しています。これにより、データの整合性が保証され、エラーの早期検出が可能になります。例えば、`EmailStr`や`HttpUrl`型を用いて、メールアドレスやURLの形式を自動的に検証しています。

### 2. **S3を活用した効率的な画像処理**
   - 画像を効率的に処理するために、画像ファイルを直接APIに送信するのではなく、まずAmazon S3にアップロードし、その後生成された署名付きURLをAPIに渡す手法を採用しています。これにより、ネットワーク帯域の節約と処理速度の向上が実現します。

### 3. **コードの再利用性とモジュール化**
   - S3とのやり取りを行う処理を`download_dir`や`upload_image_to_s3`といった関数に分離することで、コードの再利用性が向上しています。このモジュール化により、メンテナンスが容易になり、同じ処理を繰り返す必要がなくなります。

### 4. **パフォーマンスとリソースの最適化**
   - モデル推論時に、利用可能な場合はGPUを、それ以外の場合はCPUを自動的に選択する仕組みを導入しています。これにより、モデルの実行速度が最大限に引き出されます。また、推論にかかる時間を測定して出力することで、ユーザーはパフォーマンスの状況を把握できます。

### 5. **シンプルで拡張性の高いAPI設計**
   - 各機械学習モデル（例: 感情分類器、災害分類器、ポーズ分類器）ごとに専用のエンドポイントを設け、責務を明確にしています。この設計により、新しいモデルを追加する際にも簡単にエンドポイントを増やすことができ、システムの拡張性が高まります。




